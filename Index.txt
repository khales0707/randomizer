/* üé¨ Header personalizado refinado */
.header-personal {
  margin-top: 40px;
  text-align: center;
}

.header-personal .avatar {
  width: 110px;
  height: 110px;
  border-radius: 50%;
  object-fit: cover;
  box-shadow: 0 0 12px rgba(0,0,0,0.6);
  border: 2px solid #1db954;
  margin-bottom: 20px;
  transition: transform 0.3s ease;
}

.header-personal .avatar:hover {
  transform: scale(1.05);
}

.header-box {
  background: rgba(0,0,0,0.7);
  padding: 20px 30px;
  border-radius: 12px;
  display: inline-block;
  max-width: 400px;
  margin: 0 auto;
  box-shadow: 0 0 10px rgba(0,0,0,0.3);
}

.header-box h1 {
  font-size: 2em;
  margin: 0;
  color: #1db954;
  letter-spacing: 2px;
}

.header-box .firma {
  font-size: 1em;
  color: #ccc;
  margin-top: 8px;
}

.header-box .firma a {
  color: #ccc;
  text-decoration: none;
  font-weight: 500;
}

.header-box .firma a:hover {
  color: #1db954;
}
<body>
  <div class="header-personal">
    <img src="icon-192.png" alt="Avatar Mundoo" class="avatar">
    <div class="header-box">
      <h1>Random Movie</h1>
      <p class="firma">
        <a href="https://www.instagram.com/mundoo.cine" target="_blank">@mundoo.cine</a>
      </p>
    </div>
  </div>

  <div class="controls">
    <input type="number" id="numero" placeholder="Eleg√≠ un n√∫mero">
    <button onclick="buscarPelicula()">Buscar pel√≠cula</button>
    <button onclick="azar()">üé≤ Pel√≠cula al Azar</button>
  </div>

  <div id="resultado"></div>
  <script>
    let peliculas = [];
    const API_KEY = "b9911fb46e0e11491607c279cce876a1";

    document.addEventListener("DOMContentLoaded", () => {
      const input = document.getElementById("numero");
      input.addEventListener("keydown", (e) => {
        if (e.key === "Enter") buscarPelicula();
      });
    });

    fetch("peliculas.json")
      .then(resp => resp.json())
      .then(data => {
        peliculas = data;
        console.log("Pel√≠culas cargadas:", peliculas.length);
      })
      .catch(err => console.error("Error cargando JSON:", err));

    function buscarPelicula() {
      const numero = document.getElementById("numero").value;
      mostrarPelicula(numero);
    }

    function azar() {
      if (peliculas.length === 0) {
        alert("Todav√≠a no se cargaron pel√≠culas");
        return;
      }
      const randomIndex = Math.floor(Math.random() * peliculas.length);
      mostrarPelicula(peliculas[randomIndex].Position);
    }

    async function mostrarPelicula(numero) {
      const contenedor = document.getElementById("resultado");
      contenedor.innerHTML = "<div class='card'><div class='info'><p>Buscando‚Ä¶</p></div></div>";

      const peli = peliculas.find(p => p.Position == numero);
      if (!peli) {
        contenedor.innerHTML = "<div class='card'><div class='info'><p>No encontr√© esa posici√≥n.</p></div></div>";
        return;
      }

      try {
        const searchUrl = `https://api.themoviedb.org/3/search/movie?api_key=${API_KEY}&language=es-ES&query=${encodeURIComponent(peli.Name)}&year=${peli.Year || ""}`;
        const resp = await fetch(searchUrl);
        const data = await resp.json();

        if (!data.results || data.results.length === 0) {
          contenedor.innerHTML = `<div class='card'><div class='info'><p>No encontr√© "${peli.Name}" en TMDb.</p></div></div>`;
          return;
        }

        const movie = data.results[0];

        const detailsResp = await fetch(`https://api.themoviedb.org/3/movie/${movie.id}?api_key=${API_KEY}&language=es-ES`);
        let details = await detailsResp.json();
        if (!details.overview) {
          const detailsEnResp = await fetch(`https://api.themoviedb.org/3/movie/${movie.id}?api_key=${API_KEY}&language=en-US`);
          const detailsEn = await detailsEnResp.json();
          if (detailsEn.overview) details.overview = detailsEn.overview;
        }

        const creditsResp = await fetch(`https://api.themoviedb.org/3/movie/${movie.id}/credits?api_key=${API_KEY}&language=es-ES`);
        const credits = await creditsResp.json();

        const poster = movie.poster_path ? `https://image.tmdb.org/t/p/w300${movie.poster_path}` : "";
        const director = credits.crew?.find(p => p.job === "Director");
        const actores = (credits.cast || []).slice(0, 4);
        const generos = (details.genres || []).map(g => g.name).join(", ");

        let country = "ar";
        const locale = navigator.language || "";
        if (locale.toLowerCase().includes("es-es")) country = "es";
        else if (locale.toLowerCase().includes("es-mx")) country = "mx";
        else if (locale.toLowerCase().includes("es-ar")) country = "ar";

        const tituloOriginal = details.original_title || peli.Name;
        const tituloLocal = movie.title || tituloOriginal;
        const tituloMostrar = (tituloOriginal !== tituloLocal) ? `${tituloOriginal} (${tituloLocal})` : tituloOriginal;
        const justwatchUrl = `https://www.justwatch.com/${country}/buscar?q=${encodeURIComponent(tituloOriginal)}`;

        contenedor.innerHTML = `
          <div class="card">
            <div class="poster">${poster ? `<img src="${poster}" alt="${tituloOriginal}">` : ""}</div>
            <div class="info">
              <div class="numero">Pel√≠cula #${peli.Position} de tu lista</div>
              <h2>${tituloMostrar} (${movie.release_date?.slice(0, 4) || peli.Year || ""})</h2>
              <p>${details.overview || "Sin sinopsis disponible."}</p>
              <div class="extra">
                <strong>G√©neros:</strong> ${generos || "N/D"}<br>
                <strong>Director:</strong> ${director ? director.name : "N/D"}<br>
              </div>
              <div class="cast">
                ${actores.map(a => `
                  <div class="actor">
                    ${a.profile_path ? `<img src="https://image.tmdb.org/t/p/w185${a.profile_path}" alt="${a.name}">` : ""}
                    <span>${a.name}</span>
                  </div>
                `).join("")}
              </div>
              <a href="${justwatchUrl}" target="_blank" class="justwatch-btn">üì∫ Ver si est√° disponible en Plataformas</a>
            </div>
          </div>
        `;
      } catch (e) {
        contenedor.innerHTML = "<div class='card'><div class='info'><p>Ocurri√≥ un error al buscar datos. Intent√° de nuevo.</p></div></div>";
        console.error(e);
      }
    }

    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("service-worker.js")
        .then(() => console.log("Service Worker registrado"))
        .catch(err => console.error("Error registrando SW:", err));
    }
  </script>
</body>
</html>
