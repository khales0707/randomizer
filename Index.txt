<!DOCTYPE html>
<html lang="es">
<head>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#1db954">
  <meta charset="UTF-8">
  <title>Randomizer by Mundoo.Cine</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    html, body { height: 100%; min-height: 100vh; }
    body {
      font-family: 'Montserrat', sans-serif;
      background: url('FONDO.jpg') no-repeat center center fixed;
      background-size: cover;
      background-attachment: fixed;
      background-color: #000;
      color: #eee;
      margin: 0; padding: 0; text-align: center;
    }
    body::before {
      content: ""; position: fixed; top:0; left:0; right:0; bottom:0;
      background: rgba(0,0,0,0.65); z-index: -1;
    }
    .header-personal { margin-top: 20px; text-align: center; }
    .header-personal .avatar {
      display: block; margin: 0 auto 15px; width: 100px; height: 100px;
      border-radius: 50%; object-fit: cover;
      box-shadow: 0 0 10px rgba(0,0,0,0.5); border: 2px solid #1db954;
    }
    .header-box {
      background: rgba(0,0,0,0.7); padding: 20px 30px; border-radius: 12px;
      display: block; max-width: 650px; margin: 0 auto;
      box-shadow: 0 0 10px rgba(0,0,0,0.3); text-align: center;
      opacity: 0; transform: translateY(20px);
      animation: aparecer 0.8s ease-out forwards;
    }
    @keyframes aparecer { to { opacity: 1; transform: translateY(0); } }
    .header-box h1 { font-size: 2.2em; margin: 0; color: #1db954; letter-spacing: 2px; }
    .header-box .firma { font-size: 1em; color: #ccc; margin-top: 5px; }
    .controls { padding: 15px; }
    input, select, button { padding: 10px 15px; font-size: 16px; margin: 5px; border: none; border-radius: 5px; }
    input, select { background: rgba(255,255,255,0.1); color: #fff; }
    button { background: #1db954; color: #fff; cursor: pointer; transition: all 0.3s ease; }
    button:hover { background: #1ed760; box-shadow: 0 0 10px rgba(29,185,84,0.7); transform: translateY(-2px); }
    select { background: #222; color: #fff; }
    select option { background: #222; color: #fff; }
    .card {
      margin: 30px auto; padding: 20px; background: rgba(20,20,20,0.85);
      border-radius: 12px; max-width: 900px; border: 1px solid rgba(255,255,255,0.1);
      display: flex; gap: 20px; text-align: left;
    }
    .poster { flex: 1; }
    .poster img { width: 100%; border-radius: 8px; box-shadow: 0 6px 20px rgba(0,0,0,0.8); }
    .info { flex: 2; }
    h2 { color: #ffcc00; margin-top: 0; }
    .extra { font-size: 0.9em; color: #bbb; margin-top: 10px; }
    .info p { font-style: italic; color: #ddd; line-height: 1.5; }
    .cast { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px; }
    .actor { display: flex; align-items: center; gap: 10px; background: rgba(255,255,255,0.05); padding: 6px 10px; border-radius: 20px; }
    .actor img { width: 80px; height: 80px; border-radius: 50%; object-fit: cover; }
    .providers img { height: 40px; border-radius: 6px; background: #fff; padding: 3px; margin: 5px; vertical-align: middle; }
    @media (max-width: 600px) {
      .card { flex-direction: column; padding: 15px; gap: 15px; }
      .poster img { max-width: 250px; margin: 0 auto; display: block; }
      .actor img { width: 50px; height: 50px; }
    }
  </style>
</head>
<body>
  <div class="header-personal">
    <img src="icon-192.png" alt="Avatar Mundoo" class="avatar">

    <div class="header-box">
      <h1>Movie Randomizer</h1>
      <p class="firma">@mundoo.cine</p>

      <!-- üîç B√∫squeda por t√≠tulo -->
      <div class="controls">
        <input type="text" id="busqueda" placeholder="Escrib√≠ un t√≠tulo de pel√≠cula">
        <button onclick="buscarPelicula()">Buscar pel√≠cula</button>
        <button onclick="azar()">üé≤ Pel√≠cula al Azar (sin filtros)</button>
      </div>

      <!-- üéõÔ∏è Filtros para azar -->
      <div class="controls">
        <label for="genero">G√©nero:</label>
        <select id="genero">
          <option value="">Cualquiera</option>
          <option value="28">Acci√≥n</option>
          <option value="35">Comedia</option>
          <option value="18">Drama</option>
          <option value="27">Terror</option>
          <option value="10749">Romance</option>
          <option value="16">Animaci√≥n</option>
          <option value="878">Ciencia Ficci√≥n</option>
          <option value="53">Thriller</option>
        </select>

        <label for="anioDesde">A√±o desde:</label>
        <input type="number" id="anioDesde" placeholder="1990" min="1900" max="2025">

        <label for="anioHasta">A√±o hasta:</label>
        <input type="number" id="anioHasta" placeholder="2005" min="1900" max="2025">

        <button onclick="azarFiltrado()">üé≤ Pel√≠cula al Azar (con filtros)</button>
      </div>
    </div>
  </div>

  <!-- Contenedor de resultados -->
  <div id="resultado"></div>
<script>
const API_KEY = "b9911fb46e0e11491607c279cce876a1"; 
const contenedor = document.getElementById("resultado");

// Buscar por t√≠tulo
async function buscarPelicula() {
  const query = document.getElementById("busqueda").value.trim();
  if (!query) {
    alert("Escrib√≠ un t√≠tulo para buscar");
    return;
  }
  contenedor.innerHTML = "<div class='card'><div class='info'><p>Buscando‚Ä¶</p></div></div>";
  try {
    const resp = await fetch(`https://api.themoviedb.org/3/search/movie?api_key=${API_KEY}&language=es-MX&query=${encodeURIComponent(query)}`);
    const data = await resp.json();
    if (!data.results || data.results.length === 0) {
      contenedor.innerHTML = `<div class='card'><div class='info'><p>No encontr√© "${query}".</p></div></div>`;
      return;
    }
    mostrarPelicula(data.results[0].id);
  } catch (e) {
    console.error(e);
    contenedor.innerHTML = "<div class='card'><div class='info'><p>Error en la b√∫squeda.</p></div></div>";
  }
}

// Pel√≠cula al azar (sin filtros)
async function azar() {
  contenedor.innerHTML = "<div class='card'><div class='info'><p>Buscando al azar‚Ä¶</p></div></div>";
  try {
    const randomPage = Math.floor(Math.random() * 50) + 1;
    const resp = await fetch(`https://api.themoviedb.org/3/movie/popular?api_key=${API_KEY}&language=es-MX&page=${randomPage}`);
    const data = await resp.json();
    if (!data.results || data.results.length === 0) {
      contenedor.innerHTML = "<div class='card'><div class='info'><p>No encontr√© nada.</p></div></div>";
      return;
    }
    const randomMovie = data.results[Math.floor(Math.random() * data.results.length)];
    mostrarPelicula(randomMovie.id);
  } catch (e) {
    console.error(e);
    contenedor.innerHTML = "<div class='card'><div class='info'><p>Error al buscar al azar.</p></div></div>";
  }
}

// Pel√≠cula al azar con filtros (Discover)
async function azarFiltrado() {
  contenedor.innerHTML = "<div class='card'><div class='info'><p>Buscando con filtros‚Ä¶</p></div></div>";

  const genero = document.getElementById("genero").value;
  const anioDesde = document.getElementById("anioDesde").value;
  const anioHasta = document.getElementById("anioHasta").value;

  let url = `https://api.themoviedb.org/3/discover/movie?api_key=${API_KEY}&language=es-MX&include_adult=false`;

  if (genero) url += `&with_genres=${genero}`;
  if (anioDesde) url += `&primary_release_date.gte=${anioDesde}-01-01`;
  if (anioHasta) url += `&primary_release_date.lte=${anioHasta}-12-31`;

  try {
    const resp = await fetch(url + "&page=1");
    const data = await resp.json();
    if (!data.results || data.results.length === 0) {
      contenedor.innerHTML = "<div class='card'><div class='info'><p>No encontr√© nada con esos filtros.</p></div></div>";
      return;
    }

    const totalPages = Math.min(data.total_pages, 50);
    const randomPage = Math.floor(Math.random() * totalPages) + 1;

    const resp2 = await fetch(url + `&page=${randomPage}`);
    const data2 = await resp2.json();
    if (!data2.results || data2.results.length === 0) {
      contenedor.innerHTML = "<div class='card'><div class='info'><p>No encontr√© nada en esa p√°gina.</p></div></div>";
      return;
    }

    const randomMovie = data2.results[Math.floor(Math.random() * data2.results.length)];
    mostrarPelicula(randomMovie.id);
  } catch (e) {
    console.error(e);
    contenedor.innerHTML = "<div class='card'><div class='info'><p>Error al buscar con filtros.</p></div></div>";
  }
}

// Mostrar detalles + plataformas
async function mostrarPelicula(movieId) {
  try {
    const detailsResp = await fetch(`https://api.themoviedb.org/3/movie/${movieId}?api_key=${API_KEY}&language=es-MX`);
    let details = await detailsResp.json();
    if (!details.overview) {
      const detailsEnResp = await fetch(`https://api.themoviedb.org/3/movie/${movieId}?api_key=${API_KEY}&language=en-US`);
      const detailsEn = await detailsEnResp.json();
      if (detailsEn.overview) details.overview = detailsEn.overview;
    }

    const creditsResp = await fetch(`https://api.themoviedb.org/3/movie/${movieId}/credits?api_key=${API_KEY}&language=es-MX`);
    const credits = await creditsResp.json();

    const providersResp = await fetch(`https://api.themoviedb.org/3/movie/${movieId}/watch/providers?api_key=${API_KEY}`);
    const providersData = await providersResp.json();
    const providers = providersData.results?.AR?.flatrate || [];

    const poster = details.poster_path ? `https://image.tmdb.org/t/p/w300${details.poster_path}` : "";
    const director = credits.crew?.find(p => p.job === "Director");
    const actores = (credits.cast || []).slice(0,4);
    const generos = (details.genres || []).map(g => g.name).join(", ");

    const tituloOriginal = details.original_title || "";
    const tituloLocal = details.title || "";
    const subtitulo = (tituloOriginal !== tituloLocal) 
      ? `<span style="color:#ffcc00; font-size:1em;">(${tituloLocal})</span>` 
      : "";

    const rating = details.vote_average ? details.vote_average.toFixed(1) : "N/D";
    const imdbLink = details.imdb_id 
      ? `<a href="https://www.imdb.com/title/${details.imdb_id}" target="_blank" style="color:#1db954;">(IMDb)</a>` 
      : "";

    contenedor.innerHTML = `
      <div class="card">
        <div class="poster">${poster ? `<img src="${poster}" alt="${tituloOriginal}">` : ""}</div>
        <div class="info">
          <h2>${tituloOriginal} ${subtitulo} (${details.release_date?.slice(0,4) || ""})</h2>
          <p>${details.overview || "Sin sinopsis disponible."}</p>
          <div class="extra">
            <strong>G√©neros:</strong> ${generos || "N/D"}<br>
            <strong>Director:</strong> ${director ? director.name : "N/D"}<br>
            <strong>Rating:</strong> ‚≠ê ${rating}/10 ${imdbLink}
          </div>
          <div class="cast">
            ${actores.map(a => `
              <div class="actor">
                ${a.profile_path ? `<img src="https://image.tmdb.org/t/p/w185${a.profile_path}" alt="${a.name}">` : ""}
                <span>${a.name}</span>
              </div>
            `).join("")}
          </div>
          <div class="providers">
            ${providers.length ? providers.map(p => `
              <img src="https://image.tmdb.org/t/p/w45${p.logo_path}" alt="${p.provider_name}" title="${p.provider_name}">
            `).join("") : "<em>No disponible en plataformas conocidas para Argentina.</em>"}
          </div>
        </div>
      </div>
    `;
  } catch (e) {
    console.error(e);
    contenedor.innerHTML = "<div class='card'><div class='info'><p>Error al mostrar la pel√≠cula.</p></div></div>";
  }
}

// Enter para disparar b√∫squeda
document.addEventListener("DOMContentLoaded", () => {
  const input = document.getElementById("busqueda");
  input.addEventListener("keydown", (e) => {
    if (e.key === "Enter") buscarPelicula();
  });
});

// Service Worker (si lo ten√©s)
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("service-worker.js")
    .then(() => console.log("Service Worker registrado"))
    .catch(err => console.error("Error registrando SW:", err));
}
</script>
</body>
</html>
